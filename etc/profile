# Begin /etc/profile
# Written for Beyond Linux From Scratch
# by James Robertson <jameswrobertson@earthlink.net>
# modifications by Dagmar d'Surreal <rivyqntzne@pbzpnfg.arg>

# System wide environment variables and startup programs.

# System wide aliases and functions should go in /etc/bashrc.  Personal
# environment variables and startup programs should go into
# ~/.bash_profile.  Personal aliases and functions should go into
# ~/.bashrc.

# Functions to help us manage paths.  Second argument is the name of the
# path variable to be modified (default: PATH)
report() {
  echo $(serdate):$( printf '%q ' "$@" running ) >&2;
  "$@";
  x=$?;
  echo $(serdate):$( printf '%q ' "$@" returned $x ) >&2;
  return $x
}
pathremove () {
  local IFS=':'
  local NEWPATH
  local DIR
  local PATHVARIABLE=${2:-PATH}
  for DIR in ${!PATHVARIABLE} ; do
    if [ "$DIR" != "$1" ] ; then
      NEWPATH=${NEWPATH:+$NEWPATH:}$DIR
    fi
  done
  export $PATHVARIABLE="$NEWPATH"
}
serdate() {
  TZ=UTC date +%Y-%m-%d-%H-%M-%S
};
lspath() {
  (($#>1)) && { echo >&2 "usage: lspath <name>" >&2 ; return 1; }
  PATHVARIABLE=${2:-PATH}
  echo "${!PATHVARIABLE}" | tr ':' '\n'
};
  
pathprepend () {
  pathremove $1 $2
  local PATHVARIABLE=${2:-PATH}
  export $PATHVARIABLE="$1${!PATHVARIABLE:+:${!PATHVARIABLE}}"
}

pathappend () {
  pathremove $1 $2
  local PATHVARIABLE=${2:-PATH}
  export $PATHVARIABLE="${!PATHVARIABLE:+${!PATHVARIABLE}:}$1"
}

export -f pathremove pathprepend pathappend report lspath

# Set the initial path
export PATH=/bin:/usr/bin

if [ $EUID -eq 0 ] ; then
  pathappend /sbin:/usr/sbin
fi

if [ -d $HOME/bin/ ] then
  pathprepend "$HOME/bin" PATH
fi
# Setup some environment variables.
export HISTSIZE=1000
export HISTIGNORE="&:[bf]g:exit"

# Set some defaults for graphical systems
export XDG_DATA_DIRS=${XDG_DATA_DIRS:-/usr/share/}
export XDG_CONFIG_DIRS=${XDG_CONFIG_DIRS:-/etc/xdg/}
export XDG_RUNTIME_DIR=${XDG_RUNTIME_DIR:-/tmp/xdg-$USER}

# Setup a red prompt for root and a green one for users.
NORMAL="\[\e[0m\]"
RED="\[\e[1;31m\]"
GREEN="\[\e[1;32m\]"
if [[ $EUID == 0 ]] ; then
  PS1="\n$RED\u [ $NORMAL\w$RED ]\n# $NORMAL"
else
  PS1="\n$GREEN\u [ $NORMAL\w$GREEN ]\n\$ $NORMAL"
fi

for script in /etc/profile.d/*.sh ; do
  if [ -r $script ] ; then
    . $script
  fi
done

unset script RED GREEN NORMAL

# End /etc/profile
